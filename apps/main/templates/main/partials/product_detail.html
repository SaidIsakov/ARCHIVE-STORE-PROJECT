
{% block main %}
<nav class="">
    <a href="{% url "index" %}"
       hx-get="{% url "index" %}"
       hx-target="#main-content"
       hx-push-url="true"
       class="fs-5 fw-bold text-decoration-none text-dark ms-2">Home</a>
       <span class="fs-6">/</span>
</nav>

<div class="product-container">
    <div class="gallery-wrapper">
      <div class="thumbnails">
          {% for image in product.images.all %}
            <img src="{{ image.image.url}}" class="thumb-item {% if forloop.first %}active{% endif %}" alt="front">
            {% endfor %}
          </div>
        <div class="main-image-container">
            <img id="main-photo" src="{{ product.main_image.url }}" alt="Selected Product">
        </div>
    </div>

    <div class="product-info">
        <div class="new-arrival">New arrivals</div>
        <div class="product-title-row">
            <h1 class="product-title">{{ product.title }}</h1>
            <span style="font-size: 20px; cursor: pointer;">♡</span>
        </div>
        <div class="price">₽{{ product.price }}</div>

        <p class="description">
            Jacket in brown stretch wool gabardine embodies quiet sophistication with a clean silhouette and effortless drape. Made in Italy.
        </p>

        <!-- COLOR -->
        {% if product.product_color.all %}
        <div class="color-section">
        <span class="section-label">Color:</span>
            <div class="color-selector">
            {% for color in product.product_color.all %}
            <label class="color-option">
                <input type="radio" name="color" value="{{ color.id }}" {% if forloop.first %}checked{% endif %}>
                <span class="color-swatch"
                  style="background-color: {{ color.color.hex_code }};"
                  title="{{ color.color.title }}"
                  data-color-name="{{ color.color.title }}">
            </span>
          </label>
          {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Sizes -->
        {% if product.product_size.all %}
        <div class="size-header">
            <span class="section-label">Select Size</span>
        </div>

        <div class="size-selector">
          {% for product_size in product.product_size.all %}
            <label class="size-option">
                <input type="radio" name="size" value="{{ product_size.size.id }}">
                <span class="size-label">{{ product_size.size.title }}</span>
            </label>
            {% endfor %}
          </div>
        {% else %}
            <div>
                <p class="text-sm text-gray-600">No sizes available</p>
            </div>
        {% endif %}


        <button class="add-to-bag">Add to bag</button>
    </div>
</div>

<script>
   function initPageInteractivity() {
        // Галерея
        const thumbnails = document.querySelectorAll('.thumb-item');
        const mainPhoto = document.getElementById('main-photo');

        if (thumbnails.length > 0 && mainPhoto) {
            thumbnails.forEach(thumb => {
                // Удаляем старые обработчики, чтобы избежать дублирования
                thumb.removeEventListener('click', galleryHandler);
                thumb.addEventListener('click', galleryHandler);
            });
        }

        // Аккордеоны
        const accordions = document.querySelectorAll('.accordion');
        accordions.forEach(acc => {
            acc.removeEventListener('click', accordionHandler);
            acc.addEventListener('click', accordionHandler);
        });
    }

    // Обработчик для галереи
    function galleryHandler() {
        const thumbnails = document.querySelectorAll('.thumb-item');
        const mainPhoto = document.getElementById('main-photo');

        thumbnails.forEach(t => t.classList.remove('active'));
        this.classList.add('active');

        mainPhoto.style.opacity = '0';
        setTimeout(() => {
            mainPhoto.src = this.src;
            mainPhoto.style.opacity = '1';
        }, 200);
    }

    // Обработчик для аккордеонов
    function accordionHandler() {
        const icon = this.querySelector('span:last-child');
        icon.textContent = icon.textContent === '+' ? '−' : '+';
    }

    // Инициализация при полной загрузке
    document.addEventListener('DOMContentLoaded', initPageInteractivity);

    // Инициализация после HTMX-запросов
    document.addEventListener('htmx:afterSettle', initPageInteractivity);
</script>

{% endblock main %}

